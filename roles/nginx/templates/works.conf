server {
        server_name {{ inventory_hostname }};
        listen 80;
        rewrite ^ https://$server_name$request_uri? permanent;
}

server {
	 #SSL configuration
	
	 listen 443 ssl default_server;
	 listen [::]:443 ssl default_server;
	
	 #Self signed certs generated by the ssl-cert package
	 #Don't use them in a production server!
	 include snippets/snakeoil.conf;
	
	 ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # donâ€™t use SSLv3 ref: POODLE
	 ssl_ciphers HIGH:!aNULL:!MD5;
	 ssl_prefer_server_ciphers on;

	root /usr/share/pydio;

	# Add index.php to the list if you are using PHP
	index index.php index.html index.htm;

	server_name {{ inventory_hostname }};

	location / {
		try_files $uri $uri/ =404;
	}

        location /sonarr {
		proxy_pass http://127.0.0.1:8989;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
        	auth_basic "Restricted";
        	auth_basic_user_file /etc/nginx/passwd;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}	
        location /couchpotato {
		proxy_pass http://127.0.0.1:5050;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
        	auth_basic "Restricted";
        	auth_basic_user_file /etc/nginx/passwd;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}	

	# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
	#
	location ~ .php$ {
		fastcgi_split_path_info ^(.+\.php)(/.+)$;
		fastcgi_pass unix:/var/run/php5-fpm.sock;
		fastcgi_index index.php;
		include fastcgi.conf;
	}

	# deny access to .htaccess files, if Apache's document root
	# concurs with nginx's one
	#
	location ~ /\.ht {
		deny all;
	}

	location /RPC2 {
        	include scgi_params;
        	scgi_pass 127.0.0.1:5000;
	}

	location /rutorrent {
        	auth_basic "Restricted";
        	auth_basic_user_file /etc/nginx/passwd;
	}

}
